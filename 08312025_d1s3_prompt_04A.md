Phase 4.0: RPC System Integration Prompts
PROMPT 4.0A-REVISED: RPC Manager Complete Implementation
SINGLE FOCUS
Complete the RPC manager's request orchestration method to coordinate all 7 components
EXPLICIT FILE PATHS

MODIFY: src/detection/transport/rpc-manager.js

ADD: async call(method, params, options = {}) method implementation
ADD: Component orchestration flow in call() method
ADD: Import statements for all 7 components


CREATE: scripts/test-rpc-manager-basic.js

INCREMENTAL IMPLEMENTATION
Step 1: Add Component Imports
Add import statements at top of rpc-manager.js:

import { TokenBucket } from './token-bucket.js';
import { CircuitBreaker } from './circuit-breaker.js';
import { ConnectionPoolCore } from './connection-pool-core.js';
import { EndpointSelector } from './endpoint-selector.js';
import { RequestCache } from './request-cache.js';
import { BatchManager } from './batch-manager.js';
import { HedgedManager } from './hedged-manager.js';

Step 2: Initialize Components in Constructor
Add component initialization in RpcManager constructor:

constructor(config = {}) {
  this.tokenBucket = new TokenBucket(config.rateLimiting);
  this.circuitBreaker = new CircuitBreaker(config.circuitBreaker);
  this.connectionPool = new ConnectionPoolCore(config.connectionPool);
  this.endpointSelector = new EndpointSelector(config.endpoints);
  this.requestCache = new RequestCache(config.cache);
  this.batchManager = new BatchManager(config.batching);
  this.hedgedManager = new HedgedManager(config.hedging);
}

Step 3: Implement Rate Limiting Check
Add rate limiting at start of call() method:

async call(method, params, options = {}) {
  // Step 1: Rate limiting
  if (!await this.tokenBucket.consume(1)) {
    throw new Error('Rate limit exceeded');
  }
  // Continue to next step...
}

Step 4: Add Circuit Breaker Wrapper
Wrap remaining pipeline in circuit breaker:

// Step 2: Circuit breaker protection
return await this.circuitBreaker.execute(async () => {
  // Remaining pipeline goes here
});

Step 5: Add Connection Pool Agent Retrieval
Add connection pool integration:

// Step 3: Get HTTP agent
const agent = this.connectionPool.getAgent('https');

Step 6: Add Endpoint Selection
Add endpoint selection logic:

// Step 4: Select endpoint
const endpoint = this.endpointSelector.selectEndpoint();

Step 7: Test Basic Integration
Create basic test script that validates call() method works:

// scripts/test-rpc-manager-basic.js
const rpcManager = new RpcManager(config);
const result = await rpcManager.call('getTokenSupply', ['BONK_MINT_ADDRESS']);
console.log('RPC call result:', result);

CLEAR SUCCESS CRITERIA

RpcManager.call() executes without throwing errors
Method returns valid Solana RPC response data
All 7 components participate in single request
Response contains lamports/decimals fields (validates real RPC)

REQUIREMENTS-BASED VALIDATION

Compilation: RpcManager imports and initializes without errors
Execution: call() method completes getTokenSupply request
Integration: Request passes through all 7 components sequentially
Response: Returns valid Solana response format with expected fields
Error Handling: Rate limiting and circuit breaker function correctly
Component Health: All components remain operational after request