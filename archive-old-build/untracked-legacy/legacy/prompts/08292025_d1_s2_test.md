echo "Session 2 integration testing: $(date)" >> development.log

# Test component factory
node -e "
import('./system/component-factory.js').then(module => {
  console.log('✅ Component factory imported');
  const factory = module.ComponentFactory;
  return factory.create('rpc-connection-pool', {useFakes: false});
}).then(component => {
  console.log('✅ Real component created via factory');
  return component.call('getSlot', []);
}).then(result => {
  console.log('✅ Component works through factory:', result ? 'SUCCESS' : 'FAILED');
}).catch(err => {
  console.error('❌ Factory test failed:', err.message);
  process.exit(1);
});
" > session2-factory-test.txt 2>&1

# Test system orchestrator  
timeout 30 node -e "
import('./system/orchestrator.js').then(module => {
  console.log('✅ System orchestrator imported');
  const orchestrator = new module.SystemOrchestrator();
  return orchestrator.startSystem();
}).then(system => {
  console.log('✅ System started successfully');
  console.log('Active components:', Object.keys(system.components));
  return system.shutdown();
}).then(() => {
  console.log('✅ System shutdown gracefully');
}).catch(err => {
  console.error('❌ System test failed:', err.message);
  process.exit(1);
});
" > session2-system-test.txt 2>&1

# Test real/fake switching
USE_FAKES=true node -e "
import('./src/adapters/rpc-connection-pool.adapter.js').then(module => {
  console.log('✅ Adapter imported');
  return module.RpcConnectionPoolAdapter.create();
}).then(component => {
  console.log('✅ Fake component created');
  return component.call('getSlot', []);
}).then(result => {
  console.log('✅ Fake component works:', result);
}).catch(console.error);
" > session2-fake-test.txt 2>&1