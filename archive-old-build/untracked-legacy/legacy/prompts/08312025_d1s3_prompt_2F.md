PROMPT 2F: Batch Manager Component Testing
SINGLE FOCUS: Create comprehensive test suite for extracted batch-manager.js component
EXPLICIT FILE PATHS:

Target: tests/unit/batch-manager.test.js
Component Under Test: src/detection/transport/batch-manager.js

INCREMENTAL IMPLEMENTATION PROCESS:
Step 1: Create test framework and mock batch executor for BatchManager isolated testing
Step 2: Test batch size and timeout triggers with controllable request timing and patterns
Step 3: Test response routing accuracy (ensure each caller gets correct response from batch)
Step 4: Test mixed request type handling and batch formation efficiency
Step 5: Test concurrent batch operations and memory efficiency under sustained load
CLEAR SUCCESS CRITERIA:
Batching Requirements:

Batch efficiency: 80%+ reduction in actual operations for batchable request types
Timing accuracy: Batches sent within 10ms of configured timeout trigger
Size limits: Respects maximum batch size limits and never exceeds configured maximums
Response routing: 100% accurate routing of individual responses to correct original callers

Performance Requirements:

Batch formation time: <10ms overhead per request added to current pending batch
Memory per batch: <1KB memory overhead regardless of batch size up to configured maximum
Timeout accuracy: Flush pending batch within 10ms of configured timeout duration
Concurrency safety: Handle 1000 concurrent addRequest() calls without data corruption

REQUIREMENTS-BASED VALIDATION:
Measure These Metrics:

Operation reduction percentage (target: 80%+ reduction for batchable request types)
Timeout accuracy (target: Within 10ms of configured timeout for batch flushing)
Response routing accuracy (target: 100% correct Promise resolution to original callers)
Memory efficiency per batch (target: <1KB overhead per batch regardless of request count)
Batch formation latency (target: <10ms per request added to pending batch)

Mock Batch Executor Testing Approach:

Create mock batch processor that can handle various request types and return structured results
Test batch formation with different timing patterns and size configurations
Validate response splitting and routing accuracy for complex batch responses
Test edge cases (single requests, oversized batches, mixed batchable/non-batchable requests)