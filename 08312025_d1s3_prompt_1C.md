PROMPT 1C: Endpoint Selector Extraction
SINGLE FOCUS: Extract endpoint selection and rotation logic from existing 2000-line RPC connection pool
EXPLICIT FILE PATHS:

Source: src/detection/transport/rpc-connection-pool.js (lines containing "endpoint", "select", "rotate", "round", "robin", "health")
Target: src/detection/transport/endpoint-selector.js

INCREMENTAL IMPLEMENTATION PROCESS:
Step 1: Extract endpoint configuration, health tracking, and round-robin rotation logic
Step 2: Create EndpointSelector class with selection, health checking, and failover methods
Step 3: Test round-robin distribution accuracy across multiple healthy endpoints
Step 4: Test health-based endpoint filtering and automatic failover scenarios
Step 5: Create integration stub in original file: this.endpointSelector.selectEndpoint()
CLEAR SUCCESS CRITERIA:
Selection Logic Requirements:

Round-robin distribution: Even distribution across healthy endpoints within Â±5% variance
Health filtering: Unhealthy endpoints skipped 100% of the time during selection
Failover speed: Switch to healthy endpoint within 1 selectEndpoint() call after failure detected
Recovery detection: Include recovered endpoints in rotation within 30 seconds of recovery

Performance Requirements:

Selection latency: <0.5ms per selectEndpoint() call including health checks
Memory overhead: <10KB for 10 endpoints with full health tracking and statistics
Health check frequency: Configurable interval health checking (default 30 seconds)
Concurrent selection safety: 1000 concurrent selectEndpoint() calls without conflicts

Integration Requirements:

Original file compiles successfully after extraction with integration stub
Integration interface: this.endpointSelector.selectEndpoint() ready for orchestrator
Export functionality: import { EndpointSelector } from './endpoint-selector.js' works correctly
Configuration compatibility: Existing endpoint configuration environment variables work unchanged

REQUIREMENTS-BASED VALIDATION:
Measure These Metrics:

Distribution evenness percentage (target: within 5% even distribution across healthy endpoints)
Health filtering accuracy (target: 100% of unhealthy endpoints properly skipped)
Failover detection speed (target: <1 selection call to detect and switch from failed endpoint)
Recovery inclusion time (target: <30 seconds to include recovered endpoint in rotation)
Selection latency performance (target: <0.5ms per selectEndpoint() call)