PROMPT 2D: Connection Pool Core Component Testing
SINGLE FOCUS: Create comprehensive test suite for extracted connection-pool-core.js component
EXPLICIT FILE PATHS:

Target: tests/unit/connection-pool-core.test.js
Component Under Test: src/detection/transport/connection-pool-core.js

INCREMENTAL IMPLEMENTATION PROCESS:
Step 1: Create test framework and local HTTP test server for ConnectionPoolCore isolated testing
Step 2: Test HTTP agent configuration and socket reuse efficiency with multiple request patterns
Step 3: Test connection lifecycle management and proper cleanup under various scenarios
Step 4: Test keep-alive functionality and timeout handling with controlled server responses
Step 5: Test concurrent connection management and resource limits under high load
CLEAR SUCCESS CRITERIA:
Connection Management Requirements:

Socket reuse efficiency: 90%+ of requests use existing pooled connections when available
Connection cleanup: Zero socket leaks detected during 30-minute continuous operation
Keep-alive efficiency: Maintain connections for full configured timeout period
Concurrent connection handling: 100 concurrent requests without connection pool exhaustion

Performance Requirements:

Connection establishment: <50ms for new connections to localhost test server
Socket reuse latency: <5ms overhead for reusing existing pooled connections
Memory per connection: <5KB overhead per active socket in the connection pool
Connection cleanup timing: Release unused connections within configured timeout period

REQUIREMENTS-BASED VALIDATION:
Measure These Metrics:

Socket reuse percentage (target: 90%+ of requests use existing pooled connections)
Memory leak detection (target: 0 leaked sockets detected over 30-minute operation)
Connection establishment time (target: <50ms for new connections to test server)
Concurrent handling capacity (target: 100 concurrent requests without exhaustion)
Connection cleanup timing accuracy (target: Within 10% of configured timeout)

Mock HTTP Server Testing Approach:

Create local controllable HTTP test server for connection testing
Test various response patterns (fast responses, slow responses, error responses)
Validate HTTP agent configuration (keep-alive settings, maximum sockets, timeouts)
Test connection pooling behavior under different load patterns and timing scenarios