PROMPT 2G: Hedged Manager Component Testing
SINGLE FOCUS: Create comprehensive test suite for extracted hedged-manager.js component
EXPLICIT FILE PATHS:

Target: tests/unit/hedged-manager.test.js
Component Under Test: src/detection/transport/hedged-manager.js

INCREMENTAL IMPLEMENTATION PROCESS:
Step 1: Create test framework and controllable mock requests for HedgedManager isolated testing
Step 2: Test hedging delay accuracy and backup request timing with various delay configurations
Step 3: Test Promise.race cleanup and proper cancellation of losing requests
Step 4: Test hedging effectiveness statistics and success rate improvements during failures
Step 5: Test resource cleanup for losing requests and concurrent hedging safety
CLEAR SUCCESS CRITERIA:
Hedging Requirements:

Timing accuracy: Backup requests sent within 10% of configured hedging delay
Success selection: First successful response wins, all other requests properly cancelled
Resource cleanup: 100% of losing requests properly cancelled with complete cleanup
Hedging effectiveness: 95%+ improvement in success rate during simulated endpoint failures

Performance Requirements:

Hedging overhead: <20ms additional latency for hedged requests vs single requests
Cancellation speed: Losing requests cancelled within 100ms of winning request completion
Memory cleanup: No Promise memory leaks from cancelled requests (verified cleanup)
Concurrent hedging safety: Handle 100 concurrent hedged requests without conflicts

REQUIREMENTS-BASED VALIDATION:
Measure These Metrics:

Backup timing accuracy (target: Within 10% of configured hedging delay)
Request cancellation completeness (target: 100% of losing requests properly cancelled)
Success rate improvement during failures (target: 95%+ improvement vs single requests)
Memory leak detection (target: 0 leaked Promise objects after request completion)
Concurrent hedging safety (target: 100 concurrent hedged requests, 0 race conditions)

Mock Request Testing Approach:

Create controllable mock requests with adjustable response times and success/failure rates
Test various failure/success patterns for primary and backup requests
Validate cancellation behavior when primary request succeeds quickly vs slowly
Test hedging statistics accuracy and reporting for performance monitoring