PROMPT 1G: Hedged Manager Extraction
SINGLE FOCUS: Extract parallel request (hedging) logic from existing 2000-line RPC connection pool
EXPLICIT FILE PATHS:

Source: src/detection/transport/rpc-connection-pool.js (hedge, parallel, backup, race sections)
Target: src/detection/transport/hedged-manager.js

INCREMENTAL IMPLEMENTATION PROCESS:
Step 1: Extract hedging delay configuration, backup request triggering, and Promise.race logic
Step 2: Create HedgedManager class with hedged request coordination and proper Promise cleanup
Step 3: Test primary/backup request timing accuracy with controllable mock request delays
Step 4: Test request cancellation and resource cleanup (losing requests properly cancelled)
Step 5: Create integration stub in original file: await this.hedgedManager.hedgedRequest(primary, backups)
CLEAR SUCCESS CRITERIA:
Hedging Requirements:

Timing accuracy: Backup requests sent within 10% of configured hedging delay
Success selection: First successful response wins, all other requests properly cancelled
Resource cleanup: 100% of losing requests properly cancelled with no resource leaks
Hedging effectiveness: 95%+ improvement in success rate during endpoint failure scenarios

Performance Requirements:

Hedging overhead: <20ms additional latency for hedged requests compared to single requests
Cancellation speed: Losing requests cancelled within 100ms of winner completing
Memory cleanup: No Promise memory leaks from cancelled requests (complete cleanup)
Concurrent hedging safety: Handle 100 concurrent hedged requests without conflicts

Integration Requirements:

Original file compiles successfully after extraction with integration stub
Integration interface: await this.hedgedManager.hedgedRequest(primary, backups) ready for orchestrator
Export functionality: import { HedgedManager } from './hedged-manager.js' works correctly
Configuration compatibility: Existing hedging delay environment variables preserved

REQUIREMENTS-BASED VALIDATION:
Measure These Metrics:

Backup request timing accuracy (target: Within 10% of configured hedging delay)
Request cancellation completeness (target: 100% of losing requests properly cancelled)
Success rate improvement during failures (target: 95%+ improvement vs single requests)
Memory leak detection (target: 0 leaked Promise objects after request completion)
Concurrent hedging safety (target: 100 concurrent hedged requests without race conditions)