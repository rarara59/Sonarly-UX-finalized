PROMPT 4D: Production Process Management Configuration
SINGLE FOCUS: Create mathematically optimized PM2 configuration for 7-component modular RPC trading system
EXPLICIT FILE PATHS:

Primary: ecosystem.config.js - Complete PM2 configuration for modular RPC system
Secondary: scripts/calculate-memory-limits.js - Memory growth calculation for component architecture
Validation: scripts/validate-restart-frequency.js - Test 4-hour restart cycles under trading load
Monitoring: scripts/monitor-component-memory.js - Track per-component memory usage patterns
Deployment: scripts/deploy-production.sh - Graceful deployment with rollback capability

INCREMENTAL IMPLEMENTATION PROCESS:
Step 1: Calculate optimal memory limits for 7-component modular architecture based on measured growth data
Step 2: Configure PM2 cluster sizing for trading workload patterns and component distribution
Step 3: Set mathematical memory management parameters with precision safety margins
Step 4: Configure restart and failure recovery parameters for component-aware operations
Step 5: Add component-level monitoring and predictive alerting system
Step 6: Create graceful deployment and rollback procedures with health validation
Step 7: Generate production-ready configuration requiring zero manual tuning post-deployment
CLEAR SUCCESS CRITERIA:
Mathematical Memory Optimization Requirements:

Memory limits calculated from real 7-component system measurements during Phase 4B testing
Base calculation: Component baseline + measured growth rate × 4-hour target cycle
PM2 restarts occur every 4 hours ±30 minutes based on mathematical prediction (not 15-20 minutes)
System achieves 99.986% uptime target (10 seconds downtime per 4-hour cycle)
Graceful shutdown completes within 10 seconds including component degradation

Trading System Integration Requirements:

Zero missed trading opportunities due to process restart cycles
Component isolation maintained during rolling restart operations
Circuit breaker and rate limiting functionality preserved during process management
Memory leak prevention across all 7 components + RpcManager orchestrator
Component startup sequence respects dependency order during restarts

Production Deployment Requirements:

Single deployment achieves optimal limits without post-deployment tuning
Automated failure recovery without manual intervention required
Blue-green deployment strategy for zero-downtime system updates
Monitoring alerts provide predictive maintenance warnings before failures
Rollback capability completes within 30 seconds if deployment issues detected

Component-Specific Memory Calculation:
// Mathematical approach for modular architecture:
Base Memory Calculation:
- RpcManager orchestrator: ~15MB + orchestration overhead
- TokenBucket: ~5MB + rate limiting state
- CircuitBreaker: ~10MB + per-service state tracking  
- EndpointSelector: ~8MB + health monitoring data
- ConnectionPoolCore: ~15MB + HTTP connection pools
- RequestCache: ~25MB + cached response data (highest growth component)
- BatchManager: ~12MB + batch accumulation buffers
- HedgedManager: ~10MB + parallel request tracking

Total Base: ~100MB (refined from 50MB baseline)
Growth Rate Measurement: Measure each component individually during Phase 4B
Target Calculation: Base + (Growth Rate × 4 hours) + 20% safety margin
Max Memory Restart: Calculated value with mathematical precision
Max Old Space Size: 150% of restart limit for Node.js heap headroom

REQUIREMENTS-BASED VALIDATION:
Measure These Metrics:

PM2 restart frequency over 24-hour continuous trading cycles (target: every 4 hours ±30 minutes)
Component memory usage patterns during sustained load (growth rate per component measured)
System availability during restart cycles (target: 99.986% = 10 seconds downtime per cycle)
Trading request success rate during process management (target: 95%+ maintained throughout)
Deployment and rollback success rate (target: 100% success with <30 second operations)
Component startup dependency resolution (target: correct order 100% of deployments)

Trading-Optimized Configuration Requirements:

Restart timing avoids detected viral meme events (delay restarts during high activity)
Component priority startup sequence (rate limiting and circuit breaker first)
Cluster scaling based on meme coin detection load patterns
Memory monitoring with component-level leak detection and isolation
Process health checks integrated with RpcManager orchestrator health reporting

Production-Ready PM2 Ecosystem Configuration:
// Target configuration structure:
module.exports = {
  apps: [{
    name: 'meme-coin-rpc-system',
    script: './src/system-main.js',
    instances: 'max', // Calculated based on CPU cores and trading concurrency
    exec_mode: 'cluster',
    max_memory_restart: '400M', // Calculated: Base + (Growth × 4h) + 20% margin
    node_args: '--max-old-space-size=600', // 150% of restart limit
    min_uptime: '10s', // Prevent restart thrashing during component init
    max_restarts: 3, // Limit restart attempts before manual intervention
    restart_delay: 4000, // Stagger restarts to maintain cluster availability
    env: {
      NODE_ENV: 'production',
      TRADING_ENABLED: 'true',
      COMPONENT_HEALTH_CHECK_INTERVAL: '30000',
      PM2_MEMORY_MONITORING: 'true'
    }
  }]
};

